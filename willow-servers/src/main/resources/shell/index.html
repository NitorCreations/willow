<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script type="text/javascript" src="term.js"></script>
    <script type="text/javascript" src="../ui/scripts/jquery.js"></script>
    <script type="text/javascript">
    var debouncer = function(func , timeout) {
        var timeoutID , timeout = timeout || 200;
        return function () {
            var scope = this , args = arguments;
            clearTimeout( timeoutID );
            timeoutID = setTimeout( function () {
                func.apply( scope , Array.prototype.slice.call( args ) );
            } , timeout );
        }
    };
    window.addEventListener('load', function() {
    	var nCols = parseInt($(window).width() / parseFloat($("html").css("font-size")) * 1.63);
    	var nRows = parseInt($(window).height() / parseFloat($("html").css("font-size")) * 0.83);
		var loc = window.location, ws_uri;
		if (loc.protocol === "https:") {
			ws_uri = "wss:";
		} else {
			ws_uri = "ws:";
		}
		ws_uri += "//" + loc.host + "/rawterminal/" + loc.search + "&cols=" + nCols + "&rows=" + nRows;
  	    var socket = new WebSocket(ws_uri);
  	    window.socket = socket;
        socket.onopen = function() {
    	    var term = new Terminal({
    	      cols: nCols,
    	      rows: nRows,
    	      screenKeys: true
    	    });
    	    term.on('data', function(data) {
    	      socket.send(data);
    	    });
    	    window.term = term;
    	    term.on('title', function(title) {
    	      document.title = title;
    	    });
    	    term.open(document.body);
    	    socket.onmessage = function(event) {
    	      term.write(event.data);
    	    };
    	    socket.onclose = function() {
    	      term.destroy();
    	    };
      };
    }, false);
    $(window).resize(debouncer(function (e) {
    	var nCols = parseInt($(window).width() / parseFloat($("html").css("font-size")) * 1.63);
    	var nRows = parseInt($(window).height() / parseFloat($("html").css("font-size")) * 0.83);
    	window.term.resize(nCols, nRows);
    	window.socket.send("{\"cols\":" + nCols + ",\"rows\":" + nRows + "}");
	}));
    window.setInterval(function() {
    	window.socket.send("{\"ping\":1}");
    }, 2000);
    </script>
    <style type="text/css">
	body {
	  font-family: "Lucida Console", Monaco, monospace
	}
    </style>
  </head>
  <body>
  </body>
</html>